# Requirements: Invoice Analytics

*Generated from conversation on 2025-12-08*

## Objective

Add an Invoices section to the existing Analytics page that displays invoice data in 4 collapsible chart panels, matching the existing Shipped/Backorders visual pattern.

## Core Requirements

### Must Have (High Priority)

- [HIGH] Summary stats bar showing: Total Invoices count, Total Lines, Total Amount
- [HIGH] Chart 1: Invoices by Item Attributes (Product Group / Vendor / Style) with LOV selector inside panel to switch grouping
- [HIGH] Chart 2: Invoices by Order Type (ordertype field)
- [HIGH] Chart 3: Invoices by Transaction Type (invtranstype field)
- [HIGH] Chart 4: Invoices by Ship Method (shipmethod field)
- [HIGH] Each chart displays both count (number of invoices) and sum (total amount)
- [HIGH] Horizontal bar chart pattern matching existing Shipped charts
- [HIGH] All 4 charts in collapsible `<Collapse>` panels

### Should Have (Medium Priority)

- [MEDIUM] Charts use same color scheme as existing Analytics charts
- [MEDIUM] Consistent styling with existing Shipped/Backorders sections
- [MEDIUM] "Long Tail" smart aggregation - group items contributing <5% of total into "Other" category to prevent unreadable charts with many tiny bars
- [MEDIUM] Click-to-drill-down modal - clicking a bar opens filtered Invoices data in a modal/drawer (similar to BackorderDetailsModal pattern)

## Technical Constraints

- **Data Source:** Use existing `useInvoices` hook (fetches from `/api/v1/invoice-lines/`)
- **Framework/Stack:** React with Ant Design (same as existing Analytics.tsx)
- **Architecture:** Follow existing Analytics.tsx patterns for chart components
- **Chart Library:** Same as existing (likely Recharts based on Analytics components)

## Data Model

### Chart Groupings

| Chart | Field | Aggregations |
|-------|-------|--------------|
| By Item Attributes | productgrp, vendor, style (switchable) | count, sum(extended_amount) |
| By Order Type | ordertype | count, sum(extended_amount) |
| By Transaction Type | invtranstype | count, sum(extended_amount) |
| By Ship Method | shipmethod | count, sum(extended_amount) |

## User Context

**Target Users:** Dashboard users analyzing invoice data
**Primary Use Case:** View invoice distribution across different dimensions (item attributes, order types, transaction types, ship methods)
**User Flow:**
1. Navigate to Analytics page
2. See Invoices section with summary stats
3. Expand chart panels to view distribution
4. Use LOV selector in Chart 1 to switch between Product Group/Vendor/Style grouping

## UI/UX Pattern

The view follows the existing Analytics.tsx pattern:

- **Summary Stats Bar:** Horizontal bar with key metrics (like "Shipped Today" bar)
- **Collapsible Panels:** Each chart in a `<Collapse>` panel with icon + title + count
- **Horizontal Bar Charts:** Same style as ShippedTripsChart, ShippedProductChart
- **LOV Selector:** Dropdown inside panel (like Backorders "Group by" selector)

## Edge Cases & Considerations

- [HIGH] Handle empty invoice data gracefully (show "No invoices" message)
- [MEDIUM] Handle null/Unknown values in grouping fields
- [MEDIUM] Large datasets - ensure chart performance with many groups

## Success Criteria

How we know this is complete and working:

- Invoices section appears in Analytics page below existing sections
- Summary stats bar shows accurate totals
- All 4 charts render with correct data
- Chart 1 LOV selector switches between Product Group/Vendor/Style
- Each chart shows both count and sum values
- Visual style matches existing Shipped/Backorders charts
- Collapsible panels work correctly
- Small contributors (<5%) grouped into "Other" category for readability
- Clicking a chart bar opens drill-down modal with filtered invoice details

## Next Steps

1. Review this PRD for accuracy and completeness
2. If anything is missing or unclear, continue the conversation
3. Use `/clavix:plan` to generate implementation tasks
4. When ready, use the optimized prompt for implementation

---
*This PRD was generated by Clavix from conversational requirements gathering.*
