# Requirements: AI Chat Feedback

*Generated from conversation on 2025-12-05*

## Objective
Add a feedback mechanism to the existing Talk to AI page that allows users to rate AI responses (good/bad) with optional text comments, storing all feedback data in PostgreSQL for review and analysis.

## Core Requirements

### Must Have (High Priority)
- [HIGH] Thumbs up/down buttons on every AI response in the chat
- [HIGH] Optional text feedback input after rating selection
- [HIGH] Store feedback data in PostgreSQL database
- [HIGH] Capture: user question, AI response, dcid (organization), rating, optional text, timestamp, user email

### Should Have (Medium Priority)
- [MEDIUM] Email field mandatory (hardcoded for now, will integrate with Okta later)
- [MEDIUM] Clean UI integration with existing chat interface

### Could Have (Low Priority / Inferred)
- [LOW] Analytics/reporting on feedback trends (future consideration)

## Technical Constraints
- **Database:** PostgreSQL at `postgres://cocoindex:cocoindex@localhost/cocoindex`
- **Authentication:** Hardcoded email for now; Okta integration planned for future
- **Integration:** Must work with existing Talk to AI page
- **Review Method:** Direct SQL queries (no admin UI needed initially)

## User Context
**Target Users:** Users of the Talk to AI feature who want to provide feedback on AI responses
**Primary Use Case:** Capture user satisfaction with AI responses to improve the system over time
**User Flow:**
1. User receives AI response in chat
2. User clicks thumbs up or thumbs down
3. Optional: User adds text feedback
4. Feedback is saved to PostgreSQL

## Data Model

| Field | Type | Required | Notes |
|-------|------|----------|-------|
| user_question | text | Yes | The question user asked |
| ai_response | text (JSON) | Yes | Full AI response as JSON (see structure below) |
| dcid | string | Yes | Organization identifier |
| rating | enum | Yes | 'good' or 'bad' |
| feedback_text | text | No | Optional user comment |
| timestamp | datetime | Yes | Auto-generated |
| user_email | string | Yes | Hardcoded for now |

### AI Response JSON Structure

```json
{
  "content": "explanation text",
  "sql": "SELECT ... generated SQL query",
  "displayType": "table|chart|text",
  "chartType": "bar|line|pie|area",
  "queryResult": {
    "columns": ["col1", "col2"],
    "rowCount": 42,
    "executionTime": 15,
    "rows": [/* first 10 rows for context */]
  },
  "error": "error message if any",
  "usage": {
    "input_tokens": 2742,
    "output_tokens": 224,
    "cache_read_input_tokens": 0,
    "cache_creation_input_tokens": 0,
    "cost_usd": 0.003862
  }
}
```

## Edge Cases & Considerations
- What happens if user changes their rating? (Allow update or create new record?)
- Should feedback be editable after submission?
- Rate limiting to prevent spam feedback?

## Implicit Requirements
*Inferred from conversation context - please verify:*
- [UI] Feedback buttons should be visually unobtrusive but easily accessible
- [UX] Feedback submission should be quick (no page reload)
- [Data] Each AI response should be uniquely identifiable for feedback association

> **Note:** These requirements were surfaced by analyzing conversation patterns.

## Success Criteria
How we know this is complete and working:
- Users can rate any AI response with thumbs up/down
- Users can optionally add text feedback after rating
- All feedback data is successfully stored in PostgreSQL
- Data can be queried directly from the database for review

## Next Steps
1. Review this PRD for accuracy and completeness
2. If anything is missing or unclear, continue the conversation
3. When ready, use the optimized prompt for implementation

---
*This PRD was generated by Clavix from conversational requirements gathering.*
