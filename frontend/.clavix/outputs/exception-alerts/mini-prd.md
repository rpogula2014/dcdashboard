# Requirements: Exception Alerts System

*Generated from conversation on 2025-12-04*

## Objective

Build an exception alerts system that surfaces transactions needing attention across multiple data sources (orders, Descartes trips, onhand inventory). Users can configure rules dynamically to detect operational issues and view matching exceptions grouped by rule.

## Core Requirements

### Must Have (High Priority)

- [HIGH] **Alerts Page** - Display exceptions grouped by rule (e.g., "5 orders stuck at Descartes")
- [HIGH] **Drill-down capability** - Expand rule groups to see matching order details
- [HIGH] **Configuration Page** - Create and manage alert rules dynamically
- [HIGH] **Simple rule builder** - Dropdown-based condition builder for common cases
- [HIGH] **Advanced expressions** - Option to write custom logic expressions for power users
- [HIGH] **Severity levels** - Tag rules as critical, warning, or info
- [HIGH] **Configurable refresh interval** - Set per-rule refresh timing in configuration
- [HIGH] **Manual refresh button** - On-demand refresh on alerts page

### Should Have (Medium Priority)

- [MEDIUM] **Extensible architecture** - Support adding new data sources (Descartes, onhand) later
- [MEDIUM] **Visual severity indicators** - Color-code or badge exceptions by severity level

### Could Have (Low Priority / Future)

- [LOW] Mark as resolved/acknowledged
- [LOW] Add notes to exceptions
- [LOW] Assign exceptions to team members
- [LOW] Descartes trip alerts
- [LOW] Onhand inventory alerts

## Technical Constraints

- **Framework/Stack:** React (existing DC Dashboard)
- **Data Source (v1):** Orders only (dc_order_lines table in DuckDB)
- **Query Engine:** DuckDB for local data querying
- **Extensibility:** Architecture should support future data sources
- **Display:** View-only for v1 (no write-back actions)

## User Context

**Target Users:** Operations team, managers, support analysts

**Primary Use Case:** Proactively identify and resolve operational issues before they escalate

**User Flow:**
1. User opens Alerts page
2. Sees exceptions grouped by rule with counts and severity
3. Expands a rule group to see matching orders
4. Goes to source system to resolve the issue
5. Refreshes to verify resolution

## Example Rules (v1 - Orders)

| Rule Name | Condition | Pattern |
|-----------|-----------|---------|
| Stuck at Descartes | Orders sent to Descartes but not planned | routed='Y' AND planned='N' |
| Ready but not routed | Orders with reservations, no holds, not ship-set, but not sent to Descartes | reserved_qty > 0 AND hold_applied='N' AND ship_set IS NULL AND routed='N' |

## Edge Cases & Considerations

- **Empty results:** Show "No exceptions" state when all rules pass
- **Rule errors:** Handle invalid rule expressions gracefully with error messages
- **Large result sets:** Consider pagination or summarization for rules matching many records
- **Refresh timing:** Prevent overlapping refreshes; show loading state during refresh

## Success Criteria

How we know this is complete and working:

- Users can create rules using simple dropdown builder
- Users can create advanced rules with custom expressions
- Alerts page shows exceptions grouped by rule name
- Users can expand groups to see individual order details
- Severity levels are configurable and visually distinct
- Refresh works both manually and on configured intervals
- System is ready to add Descartes/onhand sources in future iterations

## Next Steps

1. Review this PRD for accuracy and completeness
2. Use `/clavix:plan` to generate implementation tasks
3. When ready, implement with `/clavix:implement`

---
*This PRD was generated by Clavix from conversational requirements gathering.*
